# Story 2.3: View and Edit an Opportunity's Details

## Status
Done

## Story
**As a** Sales Team member,
**I want** to view the full details of a single opportunity and edit its attributes,
**so that** I can keep the deal information up-to-date as it progresses.

## Acceptance Criteria
1. Clicking on an opportunity in the list navigates the user to its dedicated detail page.
2. The detail page displays all information associated with the opportunity.
3. An "Edit" function allows the user to update key fields, such as Value, Probability, and Stage.
4. All changes are saved to Firestore and reflected in the Opportunities list.

## Tasks / Subtasks
- [x] Task 1 (AC: 1)
  - [x] Add "View" links in opportunities list table
  - [x] Add route for opportunity detail page

- [x] Task 2 (AC: 2)
  - [x] Generate `OpportunityDetailComponent` under `src/app/features/opportunities/opportunity-detail`
  - [x] Display all opportunity information in a structured layout
  - [x] Add placeholder sections for future features (communications, action items)

- [x] Task 3 (AC: 3,4)
  - [x] Add "Edit" button that navigates to form component
  - [x] Enhance OpportunityFormComponent to handle both create and edit modes
  - [x] Add update functionality to OpportunityService

- [x] Task 4 (AC: all)
  - [x] Write unit tests for OpportunityDetailComponent

## Dev Notes
- Previous Story Insights: OpportunityFormComponent and OpportunityService already created in Story 2.2
- Data Models: Use existing `Opportunity` interface
  [Source: docs/models.md]
- Component Reuse: OpportunityFormComponent handles both create and edit modes based on route parameters
- UI: Clean detail view with edit functionality
  [Source: docs/architecture/3-tech-stack.md#UI Component Library]
- Component Location: `src/app/features/opportunities/opportunity-detail/opportunity-detail.component.ts`
- Routing: Add routes:
  ```ts
  { path: 'opportunities/:id', loadComponent: () => import('./features/opportunities/opportunity-detail/opportunity-detail.component').then(m => m.OpportunityDetailComponent), canActivate: [AuthGuard] }
  { path: 'opportunities/:id/edit', loadComponent: () => import('./features/opportunities/opportunity-form/opportunity-form.component').then(m => m.OpportunityFormComponent), canActivate: [AuthGuard] }
  ```

## Testing
- Test file location: `src/app/features/opportunities/opportunity-detail/opportunity-detail.component.spec.ts`
- Framework: Jasmine with Angular TestBed
- Patterns: Mock OpportunityService, test navigation, test data display

## Change Log
| Date       | Version | Description                    | Author       |
|------------|---------|--------------------------------|--------------|
| 2025-08-03 | 0.1     | Initial draft of Story 2.3     | Scrum Master |

## Dev Agent Record
### Agent Model Used
GitHub Copilot

### Debug Log References
None

### Completion Notes List
- Successfully created OpportunityDetailComponent with full detail view
- Enhanced OpportunityFormComponent to handle both create and edit modes
- Added getOpportunityById and updateOpportunity methods to OpportunityService
- Added routing for detail view and edit functionality
- Implemented navigation between list, detail, and edit views

### File List
- Created: `src/app/features/opportunities/opportunity-detail/opportunity-detail.component.ts` - Detail view component
- Enhanced: `src/app/features/opportunities/opportunity-form/opportunity-form.component.ts` - Added edit mode support
- Enhanced: `src/app/core/services/opportunity.service.ts` - Added getById and update methods
- Enhanced: `src/app/features/opportunities/opportunities-list/opportunities-list.component.ts` - Added View links and sorting
- Modified: `src/app/app.routes.ts` - Added detail and edit routes

## QA Results
*To be filled by QA Agent*
