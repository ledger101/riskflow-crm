import{a as U}from"./chunk-QYYEOJ6R.js";import{c as O,e as g,f as G,g as q,i as B,j as L,k as j,l as A,p as $,q as R,s as z,u as H}from"./chunk-N72T7JVJ.js";import{i as D}from"./chunk-3L2WMKXX.js";import{Cb as c,Cc as V,Dc as N,Eb as s,Gc as T,Lb as F,Mb as a,Nb as M,Ob as b,Vb as I,Wa as d,Xa as S,a as y,ac as k,e as h,ja as w,kb as f,ob as m,pb as C,ra as p,sa as u,ta as E,tb as i,ua as P,ub as t,vb as x,zb as v}from"./chunk-UAJ5BYCW.js";function K(l,n){l&1&&(i(0,"div",24),a(1," Stage name is required "),t())}function Q(l,n){l&1&&(i(0,"span"),a(1,"Default probability is required"),t())}function W(l,n){l&1&&(i(0,"span"),a(1," Probability must be between 0 and 100 "),t())}function X(l,n){if(l&1&&(i(0,"div",24),f(1,Q,2,0,"span",25)(2,W,2,0,"span",25),t()),l&2){let e,o,r=s(2);d(),m("ngIf",(e=r.stageForm.get("defaultProbability"))==null||e.errors==null?null:e.errors.required),d(),m("ngIf",((o=r.stageForm.get("defaultProbability"))==null||o.errors==null?null:o.errors.min)||((o=r.stageForm.get("defaultProbability"))==null||o.errors==null?null:o.errors.max))}}function Y(l,n){if(l&1){let e=v();i(0,"div",10)(1,"div",11)(2,"div",12)(3,"h3",13),a(4),t(),i(5,"form",14),c("ngSubmit",function(){p(e);let r=s();return u(r.saveStage())}),i(6,"div")(7,"label",15),a(8,"Stage Name"),t(),x(9,"input",16),f(10,K,2,0,"div",17),t(),i(11,"div")(12,"label",15),a(13,"Default Probability (%)"),t(),x(14,"input",18),f(15,X,3,2,"div",17),t(),i(16,"div")(17,"label",15),a(18,"Display Order"),t(),x(19,"input",19),i(20,"div",20),a(21," Lower numbers appear first in dropdowns "),t()(),i(22,"div",21)(23,"button",22),a(24),t(),i(25,"button",23),c("click",function(){p(e);let r=s();return u(r.closeForm())}),a(26," Cancel "),t()()()()()()}if(l&2){let e,o,r=s();d(4),b(" ",r.isEditMode?"Edit Pipeline Stage":"Create New Pipeline Stage"," "),d(),m("formGroup",r.stageForm),d(5),m("ngIf",((e=r.stageForm.get("name"))==null?null:e.invalid)&&((e=r.stageForm.get("name"))==null?null:e.touched)),d(5),m("ngIf",((o=r.stageForm.get("defaultProbability"))==null?null:o.invalid)&&((o=r.stageForm.get("defaultProbability"))==null?null:o.touched)),d(8),m("disabled",r.stageForm.invalid||r.saving),d(),b(" ",r.saving?"Saving...":r.isEditMode?"Update Stage":"Create Stage"," ")}}function Z(l,n){if(l&1){let e=v();i(0,"tr",33)(1,"td",34),a(2),t(),i(3,"td",35)(4,"div",36),a(5),t()(),i(6,"td",35)(7,"div",37)(8,"div",38),x(9,"div",39),t(),i(10,"span",40),a(11),t()()(),i(12,"td",41)(13,"div",42)(14,"button",43),c("click",function(){let r=p(e).$implicit,_=s(2);return u(_.openEditForm(r))}),a(15," Edit "),t(),i(16,"button",44),c("click",function(){let r=p(e).$implicit,_=s(2);return u(_.deleteStage(r))}),a(17),t()()()()}if(l&2){let e=n.$implicit,o=s(2);d(2),b(" ",e.order," "),d(3),M(e.name),d(4),C("width",e.defaultProbability,"%"),d(2),b("",e.defaultProbability,"%"),d(5),m("disabled",o.deleting===e.id),d(),b(" ",o.deleting===e.id?"Deleting...":"Delete"," ")}}function ee(l,n){if(l&1&&(i(0,"div",26)(1,"div",27)(2,"table",28)(3,"thead",29)(4,"tr")(5,"th",30),a(6," Order "),t(),i(7,"th",30),a(8," Stage Name "),t(),i(9,"th",30),a(10," Default Probability "),t(),i(11,"th",30),a(12," Actions "),t()()(),i(13,"tbody",31),f(14,Z,18,7,"tr",32),t()()()()),l&2){let e=s();d(14),m("ngForOf",e.stages)}}function te(l,n){if(l&1){let e=v();i(0,"div",45)(1,"div",46),E(),i(2,"svg",47),x(3,"path",48),t()(),P(),i(4,"h3",49),a(5,"No pipeline stages"),t(),i(6,"p",50),a(7,"Get started by creating your first pipeline stage."),t(),i(8,"div",51)(9,"button",52),c("click",function(){p(e);let r=s();return u(r.openCreateForm())}),a(10," Create First Stage "),t()()()}}var J=class l{constructor(n,e){this.pipelineStageService=n;this.fb=e;this.stageForm=this.fb.group({name:["",[g.required,g.minLength(2)]],defaultProbability:[0,[g.required,g.min(0),g.max(100)]],order:[0,[g.required,g.min(0)]]})}stages=[];stageForm;showForm=!1;isEditMode=!1;currentStageId=null;saving=!1;deleting=null;ngOnInit(){this.loadStages()}loadStages(){this.pipelineStageService.getStages().subscribe({next:n=>{this.stages=n.sort((e,o)=>e.order-o.order)},error:n=>{console.error("Error loading stages:",n)}})}openCreateForm(){this.isEditMode=!1,this.showForm=!0,this.currentStageId=null;let n=this.stages.length>0?Math.max(...this.stages.map(e=>e.order))+1:0;this.stageForm.reset({name:"",defaultProbability:50,order:n})}openEditForm(n){this.isEditMode=!0,this.showForm=!0,this.currentStageId=n.id,this.stageForm.patchValue({name:n.name,defaultProbability:n.defaultProbability,order:n.order})}closeForm(){this.showForm=!1,this.currentStageId=null,this.isEditMode=!1,this.stageForm.reset()}saveStage(){return h(this,null,function*(){if(!(this.stageForm.invalid||this.saving)){this.saving=!0;try{let n=this.stageForm.value;this.isEditMode&&this.currentStageId?yield this.pipelineStageService.updateStage(y({id:this.currentStageId},n)):yield this.pipelineStageService.addStage(n),this.closeForm()}catch(n){console.error("Error saving stage:",n),alert("Failed to save stage. Please try again.")}finally{this.saving=!1}}})}deleteStage(n){return h(this,null,function*(){if(confirm(`Are you sure you want to delete the "${n.name}" stage? This action cannot be undone.`)){this.deleting=n.id;try{yield this.pipelineStageService.deleteStage(n.id)}catch(e){console.error("Error deleting stage:",e),alert("Failed to delete stage. Please try again.")}finally{this.deleting=null}}})}static \u0275fac=function(e){return new(e||l)(S(U),S(z))};static \u0275cmp=w({type:l,selectors:[["app-pipeline-stage-management"]],standalone:!0,features:[I],decls:16,vars:3,consts:[["noStages",""],[1,"p-8"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold"],[1,"text-gray-600"],[1,"flex","space-x-3"],[1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded",3,"click"],["routerLink","/opportunities",1,"bg-gray-500","hover:bg-gray-700","text-white","font-bold","py-2","px-4","rounded"],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",4,"ngIf"],["class","bg-white shadow overflow-hidden sm:rounded-lg",4,"ngIf","ngIfElse"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50"],[1,"relative","top-20","mx-auto","p-5","border","w-96","shadow-lg","rounded-md","bg-white"],[1,"mt-3"],[1,"text-lg","leading-6","font-medium","text-gray-900","text-center","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","text-sm","font-medium","text-gray-700"],["type","text","formControlName","name","placeholder","e.g., Prospecting, Proposal, Negotiation",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500"],["class","text-red-500 text-sm mt-1",4,"ngIf"],["type","number","formControlName","defaultProbability","min","0","max","100","step","1","placeholder","e.g., 25, 50, 75",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500"],["type","number","formControlName","order","min","0","step","1",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500"],[1,"text-gray-500","text-sm","mt-1"],[1,"flex","space-x-3","pt-4"],["type","submit",1,"flex-1","bg-green-500","hover:bg-green-700","disabled:bg-gray-400","disabled:cursor-not-allowed","text-white","font-bold","py-2","px-4","rounded",3,"disabled"],["type","button",1,"flex-1","bg-gray-500","hover:bg-gray-700","text-white","font-bold","py-2","px-4","rounded",3,"click"],[1,"text-red-500","text-sm","mt-1"],[4,"ngIf"],[1,"bg-white","shadow","overflow-hidden","sm:rounded-lg"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","font-medium","text-gray-900"],[1,"flex","items-center"],[1,"w-16","bg-gray-200","rounded-full","h-2","mr-3"],[1,"bg-blue-500","h-2","rounded-full"],[1,"text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium"],[1,"flex","space-x-2"],[1,"text-blue-600","hover:text-blue-800","font-medium",3,"click"],[1,"text-red-600","hover:text-red-800","font-medium","disabled:text-gray-400",3,"click","disabled"],[1,"text-center","py-12","bg-white","rounded-lg","shadow"],[1,"mx-auto","h-12","w-12","text-gray-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"mt-2","text-sm","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],[1,"mt-6"],[1,"inline-flex","items-center","px-4","py-2","border","border-transparent","shadow-sm","text-sm","font-medium","rounded-md","text-white","bg-blue-600","hover:bg-blue-700",3,"click"]],template:function(e,o){if(e&1){let r=v();i(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),a(4,"Pipeline Stage Management"),t(),i(5,"p",4),a(6,"Manage sales pipeline stages and their default probabilities"),t()(),i(7,"div",5)(8,"button",6),c("click",function(){return p(r),u(o.openCreateForm())}),a(9," Create New Stage "),t(),i(10,"a",7),a(11," Back to Opportunities "),t()()(),f(12,Y,27,6,"div",8)(13,ee,15,1,"div",9)(14,te,11,0,"ng-template",null,0,k),t()}if(e&2){let r=F(15);d(12),m("ngIf",o.showForm),d(),m("ngIf",o.stages.length>0)("ngIfElse",r)}},dependencies:[T,V,N,H,B,O,L,G,q,R,$,j,A,D],encapsulation:2})};export{J as PipelineStageManagementComponent};
