import{a as z}from"./chunk-RYOOWDOU.js";import"./chunk-2YBQOG5B.js";import{c as F,e as f,f as T,g as N,i as G,k as V,l as M,s as k,u as L}from"./chunk-N72T7JVJ.js";import"./chunk-6HUQKW6B.js";import{h as P}from"./chunk-3L2WMKXX.js";import{Cb as w,Dc as b,Eb as p,Gc as I,Lb as y,Mb as s,Nb as h,Vb as C,Wa as m,Xa as u,ac as E,e as c,ja as S,kb as d,ob as a,ra as g,sa as x,tb as o,ub as n,vb as _,zb as v}from"./chunk-UAJ5BYCW.js";function R(e,i){e&1&&(o(0,"p",6),s(1,"Complete your account setup by choosing a secure password."),n())}function q(e,i){e&1&&(o(0,"span"),s(1,"Continue"),n())}function A(e,i){e&1&&(o(0,"span"),s(1,"Processing..."),n())}function j(e,i){if(e&1&&(o(0,"div",14),s(1),n()),e&2){let t=p(3);m(),h(t.error)}}function B(e,i){if(e&1){let t=v();o(0,"form",7),w("ngSubmit",function(){g(t);let r=p(2);return x(r.completeLinkFromEmail())}),o(1,"p",8),s(2,"Enter your email to complete sign-in from the link."),n(),o(3,"div")(4,"label",9),s(5,"Email"),n(),_(6,"input",10),n(),o(7,"button",11),d(8,q,2,0,"span",12)(9,A,2,0,"span",12),n(),d(10,j,2,1,"div",13),n()}if(e&2){let t=p(2);a("formGroup",t.emailForm),m(7),a("disabled",t.emailForm.invalid||t.loading),m(),a("ngIf",!t.loading),m(),a("ngIf",t.loading),m(),a("ngIf",t.error)}}function O(e,i){e&1&&(o(0,"div",18),s(1," Password must be at least 8 characters "),n())}function U(e,i){e&1&&(o(0,"div",18),s(1," Confirmation required "),n())}function Y(e,i){e&1&&(o(0,"div",18),s(1," Passwords do not match "),n())}function H(e,i){e&1&&(o(0,"span"),s(1,"Set Password & Continue"),n())}function J(e,i){e&1&&(o(0,"span"),s(1,"Setting Password..."),n())}function K(e,i){if(e&1&&(o(0,"div",14),s(1),n()),e&2){let t=p(3);m(),h(t.error)}}function Q(e,i){if(e&1){let t=v();o(0,"form",7),w("ngSubmit",function(){g(t);let r=p(2);return x(r.onSubmit())}),o(1,"div")(2,"label",9),s(3,"Password"),n(),_(4,"input",15),d(5,O,2,0,"div",16),n(),o(6,"div")(7,"label",9),s(8,"Confirm Password"),n(),_(9,"input",17),d(10,U,2,0,"div",16)(11,Y,2,0,"div",16),n(),o(12,"button",11),d(13,H,2,0,"span",12)(14,J,2,0,"span",12),n(),d(15,K,2,1,"div",13),n()}if(e&2){let t,l,r=p(2);a("formGroup",r.form),m(5),a("ngIf",((t=r.form.get("password"))==null?null:t.touched)&&((t=r.form.get("password"))==null?null:t.invalid)),m(5),a("ngIf",((l=r.form.get("confirm"))==null?null:l.touched)&&((l=r.form.get("confirm"))==null?null:l.invalid)),m(),a("ngIf",r.passwordMismatch),m(),a("disabled",r.form.invalid||r.loading||r.passwordMismatch),m(),a("ngIf",!r.loading),m(),a("ngIf",r.loading),m(),a("ngIf",r.error)}}function W(e,i){if(e&1&&(o(0,"div",2)(1,"h1",3),s(2,"Set Your Password"),n(),d(3,R,2,0,"p",4)(4,B,11,5,"form",5)(5,Q,16,8,"form",5),n()),e&2){let t=p();m(3),a("ngIf",!t.needsEmail),m(),a("ngIf",t.needsEmail),m(),a("ngIf",!t.needsEmail)}}function X(e,i){e&1&&(o(0,"div",19),s(1,"Initializing..."),n())}var D=class e{constructor(i,t,l){this.fb=i;this.auth=t;this.router=l;this.form=this.fb.group({password:["",[f.required,f.minLength(8)]],confirm:["",[f.required]]}),this.emailForm=this.fb.group({email:["",[f.required,f.email]]})}form;emailForm;loading=!1;initializing=!0;needsEmail=!1;error=null;ngOnInit(){return c(this,null,function*(){try{if(this.auth.getCurrentUser()){this.initializing=!1;return}if(this.auth.isEmailLink()){let i=window.localStorage.getItem("pendingEmail");if(i)try{yield this.auth.completeEmailLinkSignIn(void 0,i)}catch(t){this.error=t.message||"Failed to complete sign-in."}else this.needsEmail=!0}else{this.router.navigate(["/login"]);return}}finally{this.initializing=!1}})}get passwordMismatch(){let{password:i,confirm:t}=this.form.value;return i&&t&&i!==t}completeLinkFromEmail(){return c(this,null,function*(){if(!this.emailForm.invalid){this.loading=!0,this.error=null;try{yield this.auth.completeEmailLinkSignIn(void 0,this.emailForm.value.email),this.needsEmail=!1}catch(i){this.error=i.message||"Failed to complete sign-in"}finally{this.loading=!1}}})}onSubmit(){return c(this,null,function*(){if(!(this.form.invalid||this.passwordMismatch)){this.loading=!0,this.error=null;try{yield this.auth.setInitialPassword(this.form.value.password),this.router.navigate(["/"])}catch(i){this.error=i.message||"Failed to set password"}finally{this.loading=!1}}})}static \u0275fac=function(t){return new(t||e)(u(k),u(z),u(P))};static \u0275cmp=S({type:e,selectors:[["app-set-password"]],standalone:!0,features:[C],decls:3,vars:2,consts:[["loadingTpl",""],["class","max-w-md mx-auto mt-20 bg-white shadow rounded p-6",4,"ngIf","ngIfElse"],[1,"max-w-md","mx-auto","mt-20","bg-white","shadow","rounded","p-6"],[1,"text-xl","font-semibold","mb-4"],["class","text-sm text-gray-600 mb-6",4,"ngIf"],["class","space-y-4",3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-sm","text-gray-600","mb-6"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"text-sm","text-gray-700"],[1,"block","text-sm","font-medium","mb-1"],["type","email","formControlName","email",1,"w-full","border","rounded","px-3","py-2"],["type","submit",1,"bg-blue-600","text-white","px-4","py-2","rounded","w-full",3,"disabled"],[4,"ngIf"],["class","text-xs text-red-500",4,"ngIf"],[1,"text-xs","text-red-500"],["type","password","formControlName","password",1,"w-full","border","rounded","px-3","py-2"],["class","text-xs text-red-500 mt-1",4,"ngIf"],["type","password","formControlName","confirm",1,"w-full","border","rounded","px-3","py-2"],[1,"text-xs","text-red-500","mt-1"],[1,"max-w-md","mx-auto","mt-20","bg-white","shadow","rounded","p-6","text-center","text-sm","text-gray-600"]],template:function(t,l){if(t&1&&d(0,W,6,3,"div",1)(1,X,2,0,"ng-template",null,0,E),t&2){let r=y(2);a("ngIf",!l.initializing)("ngIfElse",r)}},dependencies:[I,b,L,G,F,T,N,V,M],encapsulation:2})};export{D as SetPasswordComponent};
