import{a as B}from"./chunk-RYOOWDOU.js";import{a as D}from"./chunk-2YBQOG5B.js";import{c as T,e as v,f as N,g as M,i as k,k as R,l as A,m as q,n as V,o as O,s as G,u as j}from"./chunk-N72T7JVJ.js";import"./chunk-6HUQKW6B.js";import{f as U,h as w}from"./chunk-3L2WMKXX.js";import{Cb as h,Dc as C,Eb as u,Gc as E,Mb as a,Nb as x,Vb as b,Wa as l,Xa as p,e as _,ja as S,kb as d,ob as s,ra as F,sa as I,tb as o,ub as n,vb as g,zb as y}from"./chunk-UAJ5BYCW.js";function L(i,r){i&1&&(o(0,"div"),a(1,"Name is required"),n())}function z(i,r){if(i&1&&(o(0,"div",16),d(1,L,2,0,"div",7),n()),i&2){let e,t=u();l(),s("ngIf",(e=t.userForm.get("name"))==null||e.errors==null?null:e.errors.required)}}function H(i,r){i&1&&(o(0,"div"),a(1,"Email is required"),n())}function J(i,r){i&1&&(o(0,"div"),a(1,"Enter a valid email"),n())}function K(i,r){if(i&1&&(o(0,"div",16),d(1,H,2,0,"div",7)(2,J,2,0,"div",7),n()),i&2){let e,t,m=u();l(),s("ngIf",(e=m.userForm.get("email"))==null||e.errors==null?null:e.errors.required),l(),s("ngIf",(t=m.userForm.get("email"))==null||t.errors==null?null:t.errors.email)}}function Q(i,r){i&1&&(o(0,"div")(1,"label",3),a(2,"Password (optional)"),n(),g(3,"input",17),o(4,"div",18),a(5,"If left blank, an email sign-in link will be sent so the user can set their own password."),n()())}function W(i,r){i&1&&(o(0,"div"),a(1,"Role is required"),n())}function X(i,r){if(i&1&&(o(0,"div",16),d(1,W,2,0,"div",7),n()),i&2){let e,t=u();l(),s("ngIf",(e=t.userForm.get("role"))==null||e.errors==null?null:e.errors.required)}}function Y(i,r){i&1&&(o(0,"span"),a(1,"Processing..."),n())}function Z(i,r){if(i&1&&(o(0,"span"),a(1),n()),i&2){let e=u();l(),x(e.isEdit?"Update User":"Save User")}}function $(i,r){i&1&&(o(0,"span"),a(1,"Send Invite"),n())}function ee(i,r){i&1&&(o(0,"span"),a(1,"Sending..."),n())}function te(i,r){if(i&1){let e=y();o(0,"button",19),h("click",function(){F(e);let m=u();return I(m.sendInvite())}),d(1,$,2,0,"span",7)(2,ee,2,0,"span",7),n()}if(i&2){let e,t=u();s("disabled",t.inviting||((e=t.userForm.get("email"))==null?null:e.invalid)||((e=t.userForm.get("role"))==null?null:e.invalid)),l(),s("ngIf",!t.inviting),l(),s("ngIf",t.inviting)}}function ie(i,r){i&1&&(o(0,"div",20),a(1,"Invitation sent successfully."),n())}function ne(i,r){if(i&1&&(o(0,"div",16),a(1),n()),i&2){let e=u();l(),x(e.errorMessage)}}var P=class i{constructor(r,e,t,m,c){this.fb=r;this.route=e;this.router=t;this.userService=m;this.authService=c;this.userForm=this.fb.group({name:["",v.required],email:["",[v.required,v.email]],password:[""],role:["",v.required]})}userForm;isEdit=!1;userId=null;loading=!1;inviting=!1;inviteSent=!1;errorMessage=null;ngOnInit(){this.userId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.userId,this.isEdit&&this.userId&&this.userService.getUsers().then(r=>{let e=r.find(t=>t.id===this.userId);e&&this.userForm.patchValue({name:e.name||"",email:e.email,role:e.role})})}onSubmit(){return _(this,null,function*(){if(!this.userForm.invalid){this.loading=!0,this.errorMessage=null;try{let{name:r,email:e,password:t,role:m}=this.userForm.value;if(this.isEdit&&this.userId)yield this.userService.updateUser(this.userId,{name:r,email:e,role:m});else{if(!t){yield this.sendInviteInternal(),this.loading=!1;return}yield this.userService.createUser({name:r,email:e,password:t,role:m})}this.router.navigate(["/admin/users"])}catch(r){this.errorMessage=r.message||"Failed to save user"}finally{this.loading=!1}}})}sendInvite(){return _(this,null,function*(){if(!(this.userForm.get("email")?.invalid||this.userForm.get("role")?.invalid)){this.inviting=!0,this.errorMessage=null;try{yield this.sendInviteInternal(),this.inviteSent=!0}catch(r){this.errorMessage=r.message||"Failed to send invite"}finally{this.inviting=!1}}})}sendInviteInternal(){return _(this,null,function*(){let{name:r,email:e,role:t}=this.userForm.value;try{yield this.userService.inviteUser({name:r,email:e,role:t})}catch{}yield this.authService.sendSignInLink(e),alert("Invitation link sent to "+e)})}static \u0275fac=function(e){return new(e||i)(p(G),p(U),p(w),p(D),p(B))};static \u0275cmp=S({type:i,selectors:[["app-user-form"]],standalone:!0,features:[b],decls:33,vars:12,consts:[[1,"p-8","max-w-md","mx-auto","space-y-4"],[1,"text-2xl","font-bold"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","mb-1"],["type","text","formControlName","name",1,"w-full","border","rounded","px-3","py-2"],["class","text-red-500 text-sm",4,"ngIf"],["type","email","formControlName","email",1,"w-full","border","rounded","px-3","py-2"],[4,"ngIf"],["formControlName","role",1,"w-full","border","rounded","px-3","py-2"],["value","Admin"],["value","Sales Team"],["value","Read-Only"],[1,"flex","items-center","space-x-2"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded",3,"disabled"],["type","button","class","bg-green-600 text-white px-4 py-2 rounded",3,"disabled","click",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"text-red-500","text-sm"],["type","password","formControlName","password","placeholder","Leave blank to send invite link",1,"w-full","border","rounded","px-3","py-2"],[1,"text-xs","text-gray-500","mt-1"],["type","button",1,"bg-green-600","text-white","px-4","py-2","rounded",3,"click","disabled"],[1,"text-green-600","text-sm"]],template:function(e,t){if(e&1&&(o(0,"div",0)(1,"h2",1),a(2),n(),o(3,"form",2),h("ngSubmit",function(){return t.onSubmit()}),o(4,"div")(5,"label",3),a(6,"Name"),n(),g(7,"input",4),d(8,z,2,1,"div",5),n(),o(9,"div")(10,"label",3),a(11,"Email"),n(),g(12,"input",6),d(13,K,3,2,"div",5),n(),d(14,Q,6,0,"div",7),o(15,"div")(16,"label",3),a(17,"Role"),n(),o(18,"select",8)(19,"option",9),a(20,"Admin"),n(),o(21,"option",10),a(22,"Sales Team"),n(),o(23,"option",11),a(24,"Read-Only"),n()(),d(25,X,2,1,"div",5),n(),o(26,"div",12)(27,"button",13),d(28,Y,2,0,"span",7)(29,Z,2,1,"span",7),n(),d(30,te,3,3,"button",14),n(),d(31,ie,2,0,"div",15)(32,ne,2,1,"div",5),n()()),e&2){let m,c,f;l(2),x(t.isEdit?"Edit User":"Create User"),l(),s("formGroup",t.userForm),l(5),s("ngIf",((m=t.userForm.get("name"))==null?null:m.touched)&&((m=t.userForm.get("name"))==null?null:m.invalid)),l(5),s("ngIf",((c=t.userForm.get("email"))==null?null:c.touched)&&((c=t.userForm.get("email"))==null?null:c.invalid)),l(),s("ngIf",!t.isEdit),l(11),s("ngIf",((f=t.userForm.get("role"))==null?null:f.touched)&&((f=t.userForm.get("role"))==null?null:f.invalid)),l(2),s("disabled",t.loading),l(),s("ngIf",t.loading),l(),s("ngIf",!t.loading),l(),s("ngIf",!t.isEdit),l(),s("ngIf",t.inviteSent),l(),s("ngIf",t.errorMessage)}},dependencies:[j,k,V,O,T,q,N,M,R,A,E,C],encapsulation:2})};export{P as UserFormComponent};
