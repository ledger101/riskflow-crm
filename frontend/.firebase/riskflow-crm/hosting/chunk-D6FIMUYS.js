import{a as G}from"./chunk-RYOOWDOU.js";import"./chunk-2YBQOG5B.js";import{c as E,e as _,f as F,g as M,i as T,k as N,l as V,s as D,u as q}from"./chunk-N72T7JVJ.js";import"./chunk-6HUQKW6B.js";import{h as L}from"./chunk-3L2WMKXX.js";import{Cb as v,Dc as I,Eb as d,Gc as b,Mb as s,Nb as c,Vb as w,Wa as o,Xa as f,e as x,ja as k,kb as p,ob as a,ra as h,sa as y,tb as l,ub as r,vb as C,zb as S}from"./chunk-UAJ5BYCW.js";function j(e,n){e&1&&(l(0,"div"),s(1,"Email is required"),r())}function A(e,n){e&1&&(l(0,"div"),s(1,"Enter a valid email"),r())}function O(e,n){if(e&1&&(l(0,"div",11),p(1,j,2,0,"div",6)(2,A,2,0,"div",6),r()),e&2){let t,i,m=d();o(),a("ngIf",(t=m.loginForm.get("email"))==null||t.errors==null?null:t.errors.required),o(),a("ngIf",(i=m.loginForm.get("email"))==null||i.errors==null?null:i.errors.email)}}function P(e,n){e&1&&(l(0,"div"),s(1,"Password is required"),r())}function B(e,n){if(e&1&&(l(0,"div",11),p(1,P,2,0,"div",6),r()),e&2){let t,i=d(2);o(),a("ngIf",(t=i.loginForm.get("password"))==null||t.errors==null?null:t.errors.required)}}function U(e,n){if(e&1&&(l(0,"div")(1,"label",12),s(2,"Password"),r(),C(3,"input",13),p(4,B,2,1,"div",5),r()),e&2){let t,i=d();o(4),a("ngIf",((t=i.loginForm.get("password"))==null?null:t.touched)&&((t=i.loginForm.get("password"))==null?null:t.invalid))}}function z(e,n){e&1&&(l(0,"div",14),s(1," Enter your email and we'll send you a secure sign-in link. "),r())}function H(e,n){e&1&&(l(0,"div",15),s(1," Link verified. Redirecting to password setup... "),r())}function J(e,n){if(e&1&&(l(0,"div",11),s(1),r()),e&2){let t=d();o(),c(t.errorMessage)}}function K(e,n){if(e&1&&(l(0,"span"),s(1),r()),e&2){let t=d();o(),c(t.loading?"Logging in...":"Login")}}function Q(e,n){if(e&1&&(l(0,"span"),s(1),r()),e&2){let t=d();o(),c(t.loading?"Sending...":"Send Sign-In Link")}}function W(e,n){if(e&1){let t=S();l(0,"div",16)(1,"a",17),v("click",function(m){let u;h(t);let g=d();return m.preventDefault(),g.linkMode=!0,y((u=g.loginForm.get("password"))==null?null:u.disable())}),s(2,"Use email link instead"),r()()}}function X(e,n){if(e&1){let t=S();l(0,"div",16)(1,"a",17),v("click",function(m){let u;h(t);let g=d();return m.preventDefault(),g.linkMode=!1,y((u=g.loginForm.get("password"))==null?null:u.enable())}),s(2,"Use password instead"),r()()}}var R=class e{constructor(n,t,i){this.fb=n;this.authService=t;this.router=i;this.loginForm=this.fb.group({email:["",[_.required,_.email]],password:["",_.required]})}loginForm;errorMessage=null;loading=!1;linkMode=!1;linkCompleted=!1;ngOnInit(){if(this.authService.isEmailLink()){this.linkMode=!0;let n=window.localStorage.getItem("pendingEmail");n&&this.completeLink(n)}}onSubmit(){return x(this,null,function*(){if(this.linkMode){if(this.loginForm.get("email")?.invalid)return;this.loading=!0,this.errorMessage=null;try{yield this.authService.sendSignInLink(this.loginForm.value.email),alert("Sign-in link sent. Check your email.")}catch(n){this.errorMessage=n.message||"Failed to send sign-in link"}finally{this.loading=!1}return}if(!this.loginForm.invalid){this.loading=!0,this.errorMessage=null;try{yield this.authService.signIn(this.loginForm.value.email,this.loginForm.value.password),this.router.navigate(["/"])}catch(n){this.errorMessage=n.message||"Login failed"}finally{this.loading=!1}}})}completeLink(n){return x(this,null,function*(){this.loading=!0,this.errorMessage=null;try{yield this.authService.completeEmailLinkSignIn(void 0,n),this.linkCompleted=!0,this.router.navigate(["/set-password"])}catch(t){this.errorMessage=t.message||"Link sign-in failed"}finally{this.loading=!1}})}static \u0275fac=function(t){return new(t||e)(f(D),f(G),f(L))};static \u0275cmp=k({type:e,selectors:[["app-login"]],standalone:!0,features:[w],decls:18,vars:12,consts:[[1,"min-h-screen","flex","items-center","justify-center"],[1,"bg-white","p-8","rounded","shadow-md","w-full","max-w-sm","space-y-4",3,"ngSubmit","formGroup"],[1,"text-xl","font-bold"],["for","email",1,"block","mb-1"],["id","email","type","email","formControlName","email",1,"w-full","border","rounded","px-3","py-2"],["class","text-red-500 text-sm",4,"ngIf"],[4,"ngIf"],["class","text-sm text-gray-600 bg-gray-50 p-2 rounded",4,"ngIf"],["class","text-sm text-green-600 bg-green-50 p-2 rounded",4,"ngIf"],["type","submit",1,"w-full","bg-blue-500","text-white","py-2","rounded",3,"disabled"],["class","text-xs text-gray-500 text-center",4,"ngIf"],[1,"text-red-500","text-sm"],["for","password",1,"block","mb-1"],["id","password","type","password","formControlName","password",1,"w-full","border","rounded","px-3","py-2"],[1,"text-sm","text-gray-600","bg-gray-50","p-2","rounded"],[1,"text-sm","text-green-600","bg-green-50","p-2","rounded"],[1,"text-xs","text-gray-500","text-center"],["href","#",1,"text-blue-600","hover:underline",3,"click"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"form",1),v("ngSubmit",function(){return i.onSubmit()}),l(2,"h2",2),s(3),r(),l(4,"div")(5,"label",3),s(6,"Email"),r(),C(7,"input",4),p(8,O,3,2,"div",5),r(),p(9,U,5,1,"div",6)(10,z,2,0,"div",7)(11,H,2,0,"div",8)(12,J,2,1,"div",5),l(13,"button",9),p(14,K,2,1,"span",6)(15,Q,2,1,"span",6),r(),p(16,W,3,0,"div",10)(17,X,3,0,"div",10),r()()),t&2){let m;o(),a("formGroup",i.loginForm),o(2),c(i.linkMode?"Email Link Sign-In":"Login"),o(5),a("ngIf",((m=i.loginForm.get("email"))==null?null:m.touched)&&((m=i.loginForm.get("email"))==null?null:m.invalid)),o(),a("ngIf",!i.linkMode),o(),a("ngIf",i.linkMode&&!i.linkCompleted),o(),a("ngIf",i.linkCompleted),o(),a("ngIf",i.errorMessage),o(),a("disabled",i.loading),o(),a("ngIf",!i.linkMode),o(),a("ngIf",i.linkMode),o(),a("ngIf",!i.linkMode),o(),a("ngIf",i.linkMode&&!i.linkCompleted)}},dependencies:[q,T,E,F,M,N,V,b,I],styles:["[_nghost-%COMP%]{display:block}"]})};export{R as LoginComponent};
