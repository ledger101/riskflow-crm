import{a as E}from"./chunk-3SOUEDWE.js";import{f as ye,g as Y,k as ie,l as xe,m as he,q as be}from"./chunk-JRVZ5TRL.js";import{a as Se}from"./chunk-QYYEOJ6R.js";import{h as ve,i as B,l as z}from"./chunk-3L2WMKXX.js";import{$ as le,$b as j,Bc as _,Cb as $,Cc as A,Dc as F,Eb as y,Fc as q,G as te,Gc as D,Lb as me,Mb as a,Nb as u,Ob as g,Pb as ge,Ub as ue,Vb as T,Wa as o,Xa as S,Zb as w,_b as k,a as ae,ac as fe,b as oe,e as b,ea as se,ja as C,kb as h,nb as pe,ob as d,p as Z,pb as M,q as N,ra as L,sa as U,ta as ce,tb as r,ua as de,ub as n,v as ee,vb as m,zb as V}from"./chunk-UAJ5BYCW.js";function Te(s,e){if(s&1){let t=V();r(0,"div",10),$("click",function(){let l=L(t).$implicit,c=y();return U(c.navigateToStage(l.key))}),r(1,"div",11)(2,"div",12)(3,"div",13),m(4,"div",11),r(5,"div")(6,"h4",14),a(7),n(),r(8,"p",15),a(9),n()()(),r(10,"div",16)(11,"p",17),a(12),w(13,"currency"),n(),r(14,"p",3),a(15),n()()(),r(16,"div",18),m(17,"div",11),n(),r(18,"div",19),m(19,"i",20),n()()()}if(s&2){let t=e.$implicit,i=e.index,l=y();M("width",l.getFunnelWidth(i),"%"),o(),M("margin-left",l.getFunnelMargin(i),"%"),d("ngClass","relative p-4 rounded-lg border-2 border-opacity-20 "+t.bgColor+" border-current"),o(3),d("ngClass","w-4 h-4 rounded-full mr-3 "+t.color),o(3),u(t.name),o(2),g("",t.count," opportunities"),o(3),u(k(13,13,t.value)),o(3),g("",t.percentage,"% of total"),o(2),M("width",t.percentage,"%"),d("ngClass","h-2 rounded-full transition-all duration-300 "+t.color)}}function De(s,e){s&1&&(r(0,"div",21),a(1," No pipeline stages configured yet. "),n())}function Ee(s,e){if(s&1&&(r(0,"div",22)(1,"div",23)(2,"div")(3,"p",24),a(4),n(),r(5,"p",25),a(6,"Total Opportunities"),n()(),r(7,"div")(8,"p",26),a(9),w(10,"currency"),n(),r(11,"p",25),a(12,"Total Pipeline Value"),n()(),r(13,"div")(14,"p",27),a(15),w(16,"currency"),n(),r(17,"p",25),a(18,"Avg Deal Size"),n()()()()),s&2){let t=y();o(4),u(t.totalOpportunities),o(5),u(j(10,3,t.totalValue,"USD","symbol","1.0-0")),o(6),u(j(16,8,t.averageDealSize,"USD","symbol","1.0-0"))}}function Ie(s,e){s&1&&(r(0,"div",28),m(1,"i",29),a(2," Updating pipeline data... "),n())}var H=class s{constructor(e,t,i){this.opportunityService=e;this.pipelineStageService=t;this.router=i}pipelineStages=[];totalOpportunities=0;totalValue=0;averageDealSize=0;isLoading=!1;colorPalette=[{color:"bg-gray-400",bg:"bg-gray-50",text:"text-gray-700"},{color:"bg-blue-400",bg:"bg-blue-50",text:"text-blue-700"},{color:"bg-yellow-400",bg:"bg-yellow-50",text:"text-yellow-700"},{color:"bg-orange-400",bg:"bg-orange-50",text:"text-orange-700"},{color:"bg-green-400",bg:"bg-green-50",text:"text-green-700"},{color:"bg-red-400",bg:"bg-red-50",text:"text-red-700"},{color:"bg-indigo-400",bg:"bg-indigo-50",text:"text-indigo-700"},{color:"bg-teal-400",bg:"bg-teal-50",text:"text-teal-700"}];ngOnInit(){this.loadPipelineData()}loadPipelineData(){return b(this,null,function*(){this.isLoading=!0;try{let[e,t]=yield Promise.all([this.pipelineStageService.getStagesPromise(),this.opportunityService.getOpportunities()]);this.buildPipeline(e,t)}catch(e){console.error("Error loading pipeline data:",e)}finally{this.isLoading=!1}})}slugify(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}buildPipeline(e,t){this.totalOpportunities=t.length,this.totalValue=t.reduce((l,c)=>l+(c.value||0),0),this.averageDealSize=this.totalOpportunities?this.totalValue/this.totalOpportunities:0;let i=e.sort((l,c)=>l.order-c.order).map((l,c)=>{let p=this.slugify(l.name),x=t.filter(W=>{let P=W.stage?.toLowerCase?.();return P===l.id.toLowerCase()||P===l.name.toLowerCase()||P===p}),f=x.reduce((W,P)=>W+(P.value||0),0),O=this.colorPalette[c%this.colorPalette.length];return{id:l.id,name:l.name,key:p,count:x.length,value:f,percentage:this.totalValue?Math.round(f/this.totalValue*100):0,color:O.color,bgColor:O.bg,textColor:O.text}});this.pipelineStages=i}getFunnelWidth(e){let i=e*8;return Math.max(100-i,60)}getFunnelMargin(e){return e*4}navigateToStage(e){this.router.navigate(["/opportunities"],{queryParams:{stage:e,from:"pipeline-widget"}})}static \u0275fac=function(t){return new(t||s)(S(E),S(Se),S(ve))};static \u0275cmp=C({type:s,selectors:[["app-pipeline-overview-widget"]],standalone:!0,features:[T],decls:13,vars:5,consts:[[1,"bg-white","rounded-lg","shadow","p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-lg","font-semibold"],[1,"text-sm","text-gray-500"],[1,"font-medium"],[1,"space-y-3","mb-6"],["class","relative cursor-pointer transition-all duration-200 hover:scale-[1.02] hover:shadow-md",3,"width","click",4,"ngFor","ngForOf"],["class","text-center text-sm text-gray-500 py-4",4,"ngIf"],["class","pt-4 border-t border-gray-200",4,"ngIf"],["class","flex items-center justify-center mt-4 text-xs text-gray-400",4,"ngIf"],[1,"relative","cursor-pointer","transition-all","duration-200","hover:scale-[1.02]","hover:shadow-md",3,"click"],[3,"ngClass"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"text-right"],[1,"font-bold","text-lg","text-gray-900"],[1,"mt-3","w-full","bg-gray-200","rounded-full","h-2"],[1,"absolute","top-2","right-2","opacity-60"],[1,"fas","fa-external-link-alt","text-xs","text-gray-500"],[1,"text-center","text-sm","text-gray-500","py-4"],[1,"pt-4","border-t","border-gray-200"],[1,"grid","grid-cols-3","gap-4","text-center"],[1,"text-2xl","font-bold","text-blue-600"],[1,"text-xs","text-gray-500"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-2xl","font-bold","text-purple-600"],[1,"flex","items-center","justify-center","mt-4","text-xs","text-gray-400"],[1,"fas","fa-sync-alt","animate-spin","mr-1"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2),a(3,"Sales Pipeline Overview"),n(),r(4,"div",3)(5,"span",4),a(6),n(),a(7," total opportunities "),n()(),r(8,"div",5),h(9,Te,20,15,"div",6)(10,De,2,0,"div",7),n(),h(11,Ee,19,13,"div",8)(12,Ie,3,0,"div",9),n()),t&2&&(o(6),u(i.totalOpportunities),o(3),d("ngForOf",i.pipelineStages),o(),d("ngIf",!i.isLoading&&i.pipelineStages.length===0),o(),d("ngIf",i.pipelineStages.length>0),o(),d("ngIf",i.isLoading))},dependencies:[D,_,A,F,q],encapsulation:2})};var R=class s{constructor(e){this.firebaseService=e}getFinancialMetrics(){try{let e=this.firebaseService.getFirestore(),t=ye(e,"financialMetrics");return Z(xe(t)).pipe(ee(i=>{let l=[];return i.forEach(c=>{let p=c.data();l.push({id:c.id,name:p.name||"",value:p.value||0,target:p.target||0,trend:p.trend||"flat",period:p.period||"monthly"})}),l}),te(i=>(console.error("Error fetching financial metrics:",i),N([]))))}catch(e){return console.error("Error in getFinancialMetrics:",e),N([])}}getSalesTargets(){try{let e=this.firebaseService.getFirestore(),t=Y(e,"settings","salesTargets");return Z(ie(t)).pipe(ee(i=>{if(i.exists()){let l=i.data();return{id:i.id,monthly:l.monthly||0,quarterly:l.quarterly||0,annual:l.annual||0,lastUpdated:l.lastUpdated?.toDate()||new Date,monthlyTarget:l.monthly||0,quarterlyTarget:l.quarterly||0,annualTarget:l.annual||0}}else return{id:"salesTargets",monthly:0,quarterly:0,annual:0,lastUpdated:new Date,monthlyTarget:0,quarterlyTarget:0,annualTarget:0}}),te(i=>(console.error("Error fetching sales targets:",i),N({id:"salesTargets",monthly:0,quarterly:0,annual:0,lastUpdated:new Date,monthlyTarget:0,quarterlyTarget:0,annualTarget:0}))))}catch(e){return console.error("Error in getSalesTargets:",e),N({id:"salesTargets",monthly:0,quarterly:0,annual:0,lastUpdated:new Date,monthlyTarget:0,quarterlyTarget:0,annualTarget:0})}}updateSalesTargets(e){try{let t=this.firebaseService.getFirestore(),i=Y(t,"settings","salesTargets");return he(i,oe(ae({},e),{lastUpdated:new Date}),{merge:!0})}catch(t){throw console.error("Error updating sales targets:",t),t}}getCurrentTargets(){return b(this,null,function*(){try{let e=this.firebaseService.getFirestore(),t=Y(e,"settings","salesTargets"),i=yield ie(t);if(i.exists()){let l=i.data();return{id:i.id,monthly:l.monthly||0,quarterly:l.quarterly||0,annual:l.annual||0,lastUpdated:l.lastUpdated?.toDate()||new Date,monthlyTarget:l.monthly||0,quarterlyTarget:l.quarterly||0,annualTarget:l.annual||0}}else return{id:"salesTargets",monthly:0,quarterly:0,annual:0,lastUpdated:new Date,monthlyTarget:0,quarterlyTarget:0,annualTarget:0}}catch(e){return console.error("Error getting current targets:",e),{id:"salesTargets",monthly:0,quarterly:0,annual:0,lastUpdated:new Date,monthlyTarget:0,quarterlyTarget:0,annualTarget:0}}})}getQuarterStartDate(e,t){let i=(t-1)*3;return new Date(e,i,1)}getQuarterEndDate(e,t){let i=t*3-1;return new Date(e,i+1,0)}getYearStartDate(e){return new Date(e,0,1)}getYearEndDate(e){return new Date(e,11,31)}static \u0275fac=function(t){return new(t||s)(se(be))};static \u0275prov=le({token:s,factory:s.\u0275fac,providedIn:"root"})};function Pe(s,e){if(s&1){let t=V();r(0,"div",25)(1,"button",26),$("click",function(){L(t);let l=y();return U(l.openTargetSettings())}),m(2,"i",27),a(3," Manage Targets "),n()()}}function _e(s,e){s&1&&(r(0,"div",28),m(1,"i",29),a(2," Updating performance data... "),n())}var J=class s{constructor(e,t){this.opportunityService=e;this.settingsService=t}salesTargets=null;annualRevenue=0;quarterlyRevenue=0;annualPerformance=0;quarterlyPerformance=0;wonOpportunities=0;conversionRate=0;currentYear=new Date().getFullYear();currentQuarter=Math.ceil((new Date().getMonth()+1)/3);isLoading=!1;isAdmin=!1;Math=Math;ngOnInit(){this.loadFinancialData(),this.loadTargets()}loadTargets(){return b(this,null,function*(){try{this.salesTargets=yield this.settingsService.getCurrentTargets()}catch(e){console.error("Error loading targets:",e)}})}loadFinancialData(){return b(this,null,function*(){try{this.isLoading=!0;let e=yield this.opportunityService.getOpportunities();this.calculateFinancialMetrics(e)}catch(e){console.error("Error loading financial data:",e)}finally{this.isLoading=!1}})}calculateFinancialMetrics(e){let t=this.currentYear,i=this.currentQuarter,l=this.settingsService.getQuarterStartDate(t,i),c=this.settingsService.getQuarterEndDate(t,i),p=this.settingsService.getYearStartDate(t),x=this.settingsService.getYearEndDate(t),f=e.filter(v=>v.stage==="closed-won"),O=f.filter(v=>{if(!v.createdAt)return!1;let I=v.createdAt.toDate?v.createdAt.toDate():new Date(v.createdAt);return I>=l&&I<=c}),W=f.filter(v=>{if(!v.createdAt)return!1;let I=v.createdAt.toDate?v.createdAt.toDate():new Date(v.createdAt);return I>=p&&I<=x});this.quarterlyRevenue=O.reduce((v,I)=>v+(I.value||0),0),this.annualRevenue=W.reduce((v,I)=>v+(I.value||0),0),this.wonOpportunities=O.length,this.salesTargets&&(this.quarterlyPerformance=this.salesTargets.quarterlyTarget>0?Math.round(this.quarterlyRevenue/this.salesTargets.quarterlyTarget*100):0,this.annualPerformance=this.salesTargets.annualTarget>0?Math.round(this.annualRevenue/this.salesTargets.annualTarget*100):0);let P=e.length;this.conversionRate=P>0?Math.round(f.length/P*100):0}getPerformanceColor(e){return e>=100?"text-green-600 font-semibold":e>=80?"text-blue-600 font-semibold":e>=60?"text-yellow-600 font-semibold":"text-red-600 font-semibold"}getProgressBarColor(e){return e>=100?"bg-green-500":e>=80?"bg-blue-500":e>=60?"bg-yellow-500":"bg-red-500"}getCircumference(){return 2*Math.PI*40}getStrokeDashoffset(e){let t=this.getCircumference(),i=Math.min(e,100)/100;return t-i*t}openTargetSettings(){console.log("Opening target settings dialog...")}static \u0275fac=function(t){return new(t||s)(S(E),S(R))};static \u0275cmp=C({type:s,selectors:[["app-financial-performance-widget"]],standalone:!0,features:[ue([E,R]),T],decls:57,vars:29,consts:[[1,"bg-white","rounded-lg","shadow","p-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-semibold"],[1,"text-xs","text-gray-500"],[1,"space-y-6"],[1,"border-b","border-gray-100","pb-4"],[1,"flex","justify-between","items-center","mb-2"],[1,"font-medium","text-gray-900"],[3,"ngClass"],[1,"space-y-2"],[1,"flex","justify-between","text-sm"],[1,"text-gray-500"],[1,"relative","w-24","h-24","mx-auto"],["viewBox","0 0 100 100",1,"w-24","h-24","transform","-rotate-90"],["cx","50","cy","50","r","40","stroke","#e5e7eb","stroke-width","8","fill","none"],["cx","50","cy","50","r","40","stroke","#3b82f6","stroke-width","8","fill","none",1,"transition-all","duration-500"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"text-lg","font-bold","text-gray-700"],[1,"w-full","bg-gray-200","rounded-full","h-3"],[1,"grid","grid-cols-2","gap-4"],[1,"text-center"],[1,"text-lg","font-bold","text-green-600"],[1,"text-lg","font-bold","text-blue-600"],["class","mt-6 pt-4 border-t border-gray-200",4,"ngIf"],["class","flex items-center justify-center mt-4 text-xs text-gray-400",4,"ngIf"],[1,"mt-6","pt-4","border-t","border-gray-200"],[1,"w-full","text-center","py-2","px-3","bg-gray-50","hover:bg-gray-100","rounded-md","text-sm","text-gray-600","transition-colors",3,"click"],[1,"fas","fa-cog","mr-2"],[1,"flex","items-center","justify-center","mt-4","text-xs","text-gray-400"],[1,"fas","fa-sync-alt","animate-spin","mr-1"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2),a(3,"Financial Performance"),n(),r(4,"div",3),a(5),n()(),r(6,"div",4)(7,"div",5)(8,"div",6)(9,"h4",7),a(10,"Annual Revenue"),n(),r(11,"span",8),a(12),n()(),r(13,"div",9)(14,"div",10)(15,"span",11),a(16),w(17,"currency"),n(),r(18,"span",11),a(19),w(20,"currency"),n()(),r(21,"div",12),ce(),r(22,"svg",13),m(23,"circle",14)(24,"circle",15),n(),de(),r(25,"div",16)(26,"span",17),a(27),n()()()()(),r(28,"div",5)(29,"div",6)(30,"h4",7),a(31,"Quarterly Revenue"),n(),r(32,"span",8),a(33),n()(),r(34,"div",9)(35,"div",10)(36,"span",11),a(37),w(38,"currency"),n(),r(39,"span",11),a(40),w(41,"currency"),n()(),r(42,"div",18),m(43,"div",8),n()()(),r(44,"div",19)(45,"div",20)(46,"p",21),a(47),n(),r(48,"p",3),a(49),n()(),r(50,"div",20)(51,"p",22),a(52),n(),r(53,"p",3),a(54,"Conversion Rate"),n()()()(),h(55,Pe,4,0,"div",23)(56,_e,3,0,"div",24),n()),t&2&&(o(5),ge(" Q",i.currentQuarter," ",i.currentYear," "),o(6),d("ngClass",i.getPerformanceColor(i.annualPerformance)),o(),g(" ",i.annualPerformance,"% "),o(4),g("Achieved: ",k(17,21,i.annualRevenue),""),o(3),g("Target: ",k(20,23,i.salesTargets==null?null:i.salesTargets.annualTarget),""),o(5),pe("stroke-dasharray",i.getCircumference())("stroke-dashoffset",i.getStrokeDashoffset(i.annualPerformance)),o(3),g("",i.annualPerformance,"%"),o(5),d("ngClass",i.getPerformanceColor(i.quarterlyPerformance)),o(),g(" ",i.quarterlyPerformance,"% "),o(4),g("Achieved: ",k(38,25,i.quarterlyRevenue),""),o(3),g("Target: ",k(41,27,i.salesTargets==null?null:i.salesTargets.quarterlyTarget),""),o(3),M("width",i.Math.min(i.quarterlyPerformance,100),"%"),d("ngClass","h-3 rounded-full transition-all duration-500 "+i.getProgressBarColor(i.quarterlyPerformance)),o(4),u(i.wonOpportunities),o(2),g("Deals Won (Q",i.currentQuarter,")"),o(3),g("",i.conversionRate,"%"),o(3),d("ngIf",i.isAdmin),o(),d("ngIf",i.isLoading))},dependencies:[D,_,F,q],encapsulation:2})};function Fe(s,e){if(s&1&&(r(0,"p",16),a(1),n()),s&2){let t=y().$implicit;o(),g(" ",t.opportunityName," ")}}function ke(s,e){if(s&1&&(r(0,"div",8)(1,"div",9),m(2,"i",9),n(),r(3,"div",10)(4,"div",11)(5,"p",12),a(6),n(),r(7,"p",13),a(8),n()(),r(9,"p",14),a(10),n(),h(11,Fe,2,1,"p",15),n()()),s&2){let t=e.$implicit,i=y(2);o(),d("ngClass","flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center "+t.color),o(),d("ngClass",t.icon+" text-white text-sm"),o(4),u(t.title),o(2),u(i.getTimeAgo(t.timestamp)),o(2),u(t.description),o(),d("ngIf",t.opportunityName)}}function Me(s,e){if(s&1&&(r(0,"div",6),h(1,ke,12,6,"div",7),n()),s&2){let t=y();o(),d("ngForOf",t.activities)}}function Ae(s,e){s&1&&(r(0,"div",17),m(1,"i",18),r(2,"p",19),a(3,"No recent activity"),n()())}var K=class s{constructor(e){this.opportunityService=e}activities=[];ngOnInit(){this.loadRecentActivity()}loadRecentActivity(){return b(this,null,function*(){try{let e=yield this.opportunityService.getOpportunities();this.generateActivityItems(e)}catch(e){console.error("Error loading recent activity:",e)}})}generateActivityItems(e){let t=[];e.filter(c=>{let p=new Date;return p.setDate(p.getDate()-30),c.createdAt&&c.createdAt.toDate()>p}).sort((c,p)=>(p.createdAt?.toDate()||new Date).getTime()-(c.createdAt?.toDate()||new Date).getTime()).slice(0,5).forEach(c=>{t.push({id:c.id||"",type:"opportunity",title:"New Opportunity Created",description:`${c.description} - ${c.value?this.formatCurrency(c.value):"No value specified"}`,timestamp:c.createdAt?.toDate()||new Date,opportunityName:c.description,icon:"fas fa-plus",color:"bg-green-500"})});let l=this.generateMockCommunications(e.slice(0,3));t.push(...l),this.activities=t.sort((c,p)=>p.timestamp.getTime()-c.timestamp.getTime()).slice(0,8)}generateMockCommunications(e){let t=[],i=[{type:"email",icon:"fas fa-envelope",color:"bg-blue-500"},{type:"call",icon:"fas fa-phone",color:"bg-purple-500"},{type:"meeting",icon:"fas fa-calendar",color:"bg-orange-500"}];return e.forEach((l,c)=>{let p=i[c%i.length],x=new Date;x.setHours(x.getHours()-(c+1)*2),t.push({id:`comm-${c}`,type:"communication",title:`${p.type.charAt(0).toUpperCase()+p.type.slice(1)} logged`,description:"Communication recorded for opportunity",timestamp:x,opportunityName:l.description,icon:p.icon,color:p.color})}),t}getTimeAgo(e){let i=Math.floor((new Date().getTime()-e.getTime())/(1e3*60));if(i<1)return"Just now";if(i<60)return`${i}m ago`;let l=Math.floor(i/60);if(l<24)return`${l}h ago`;let c=Math.floor(l/24);return c<7?`${c}d ago`:e.toLocaleDateString()}formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}static \u0275fac=function(t){return new(t||s)(S(E))};static \u0275cmp=C({type:s,selectors:[["app-recent-activity-widget"]],standalone:!0,features:[T],decls:9,vars:2,consts:[["noActivity",""],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-semibold"],["routerLink","/opportunities",1,"text-blue-500","hover:text-blue-600","text-sm","font-medium"],["class","space-y-4",4,"ngIf","ngIfElse"],[1,"space-y-4"],["class","flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"flex","items-start","space-x-3","p-3","rounded-lg","hover:bg-gray-50","transition-colors"],[3,"ngClass"],[1,"flex-1","min-w-0"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"text-sm","text-gray-600","mt-1"],["class","text-xs text-blue-600 mt-1",4,"ngIf"],[1,"text-xs","text-blue-600","mt-1"],[1,"text-center","py-8"],[1,"fas","fa-clock","text-gray-300","text-3xl","mb-2"],[1,"text-gray-500"]],template:function(t,i){if(t&1&&(r(0,"div",1)(1,"div",2)(2,"h3",3),a(3,"Recent Activity"),n(),r(4,"a",4),a(5," View All "),n()(),h(6,Me,2,1,"div",5)(7,Ae,4,0,"ng-template",null,0,fe),n()),t&2){let l=me(8);o(6),d("ngIf",i.activities.length>0)("ngIfElse",l)}},dependencies:[D,_,A,F,z,B],encapsulation:2})};function qe(s,e){if(s&1&&(r(0,"div",16)(1,"span",11),m(2,"i",11),a(3),n()()),s&2){let t=y().$implicit,i=y();o(),d("ngClass",i.getTrendClass(t.trend.direction)),o(),d("ngClass",i.getTrendIcon(t.trend.direction)),o(),g(" ",t.trend.value,"% ")}}function Re(s,e){if(s&1&&(r(0,"div",9)(1,"div",10)(2,"div",11),m(3,"i",11),n(),r(4,"div",12)(5,"p",13),a(6),n(),r(7,"p",14),a(8),n()()(),h(9,qe,4,3,"div",15),n()),s&2){let t=e.$implicit;o(2),d("ngClass","flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center "+t.color),o(),d("ngClass",t.icon+" text-white"),o(3),u(t.title),o(2),u(t.value),o(),d("ngIf",t.trend)}}var X=class s{constructor(e){this.opportunityService=e}stats=[];avgDealSize=0;avgSalesCycle=0;ngOnInit(){this.loadQuickStats()}loadQuickStats(){return b(this,null,function*(){try{let e=yield this.opportunityService.getOpportunities();this.calculateQuickStats(e)}catch(e){console.error("Error loading quick stats:",e)}})}calculateQuickStats(e){let t=e.length,i=e.filter(f=>!["closed-won","closed-lost"].includes(f.stage)).length,l=e.filter(f=>f.stage==="closed-won").length,c=e.filter(f=>f.stage==="closed-lost").length,p=t>0?Math.round(l/t*100):0,x=e.filter(f=>f.stage==="closed-won");this.avgDealSize=x.length>0?x.reduce((f,O)=>f+(O.value||0),0)/x.length:0,this.avgSalesCycle=45,this.stats=[{title:"Total Opportunities",value:t,icon:"fas fa-chart-line",color:"bg-blue-500",trend:{value:12,direction:"up"}},{title:"Active Opportunities",value:i,icon:"fas fa-hourglass-half",color:"bg-orange-500",trend:{value:8,direction:"up"}},{title:"Won This Quarter",value:l,icon:"fas fa-trophy",color:"bg-green-500",trend:{value:15,direction:"up"}},{title:"Conversion Rate",value:`${p}%`,icon:"fas fa-percentage",color:"bg-purple-500",trend:{value:3,direction:p>20?"up":"down"}}]}getTrendIcon(e){return e==="up"?"fas fa-arrow-up":"fas fa-arrow-down"}getTrendClass(e){return e==="up"?"text-green-600 text-sm font-medium":"text-red-600 text-sm font-medium"}static \u0275fac=function(t){return new(t||s)(S(E))};static \u0275cmp=C({type:s,selectors:[["app-quick-stats-widget"]],standalone:!0,features:[T],decls:18,vars:8,consts:[[1,"bg-white","rounded-lg","shadow","p-6"],[1,"text-lg","font-semibold","mb-4"],[1,"space-y-4"],["class","flex items-center justify-between p-4 rounded-lg border border-gray-200",4,"ngFor","ngForOf"],[1,"mt-6","pt-4","border-t","border-gray-200"],[1,"grid","grid-cols-2","gap-4","text-center"],[1,"text-lg","font-bold","text-blue-600"],[1,"text-xs","text-gray-500"],[1,"text-lg","font-bold","text-purple-600"],[1,"flex","items-center","justify-between","p-4","rounded-lg","border","border-gray-200"],[1,"flex","items-center"],[3,"ngClass"],[1,"ml-3"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-2xl","font-bold","text-gray-700"],["class","text-right",4,"ngIf"],[1,"text-right"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"h3",1),a(2,"Quick Stats"),n(),r(3,"div",2),h(4,Re,10,5,"div",3),n(),r(5,"div",4)(6,"div",5)(7,"div")(8,"p",6),a(9),w(10,"currency"),n(),r(11,"p",7),a(12,"Avg Deal Size"),n()(),r(13,"div")(14,"p",8),a(15),n(),r(16,"p",7),a(17,"Avg Sales Cycle"),n()()()()()),t&2&&(o(4),d("ngForOf",i.stats),o(5),u(j(10,3,i.avgDealSize,"USD","symbol","1.0-0")),o(6),g("",i.avgSalesCycle,"d"))},dependencies:[D,_,A,F,q],encapsulation:2})};var Ce=class s{static \u0275fac=function(t){return new(t||s)};static \u0275cmp=C({type:s,selectors:[["app-dashboard"]],standalone:!0,features:[T],decls:28,vars:0,consts:[[1,"p-6","bg-gray-50","min-h-screen"],[1,"max-w-7xl","mx-auto"],[1,"mb-8"],[1,"text-3xl","font-bold","text-gray-900"],[1,"mt-2","text-gray-600"],[1,"grid","grid-cols-1","lg:grid-cols-2","xl:grid-cols-3","gap-6","mb-8"],[1,"col-span-1","lg:col-span-2","xl:col-span-2"],[1,"col-span-1"],[1,"col-span-1","lg:col-span-2"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"text-xl","font-semibold","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-4"],["routerLink","/opportunities/create",1,"bg-blue-500","hover:bg-blue-600","text-white","font-semibold","py-3","px-4","rounded-lg","text-center","transition-colors"],["routerLink","/opportunities",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-3","px-4","rounded-lg","text-center","transition-colors"],["routerLink","/admin/users",1,"bg-purple-500","hover:bg-purple-600","text-white","font-semibold","py-3","px-4","rounded-lg","text-center","transition-colors"],["routerLink","/opportunities",1,"bg-orange-500","hover:bg-orange-600","text-white","font-semibold","py-3","px-4","rounded-lg","text-center","transition-colors"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Dashboard"),n(),r(5,"p",4),a(6,"Welcome to your Riskflow CRM overview"),n()(),r(7,"div",5)(8,"div",6),m(9,"app-pipeline-overview-widget"),n(),r(10,"div",7),m(11,"app-financial-performance-widget"),n(),r(12,"div",8),m(13,"app-recent-activity-widget"),n(),r(14,"div",7),m(15,"app-quick-stats-widget"),n()(),r(16,"div",9)(17,"h2",10),a(18,"Quick Actions"),n(),r(19,"div",11)(20,"a",12),a(21," Create Opportunity "),n(),r(22,"a",13),a(23," View Opportunities "),n(),r(24,"a",14),a(25," Manage Users "),n(),r(26,"a",15),a(27," Export Reports "),n()()()()())},dependencies:[D,z,B,H,J,K,X],encapsulation:2})};export{Ce as DashboardComponent};
