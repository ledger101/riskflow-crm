import{a as K}from"./chunk-J5YVJBHZ.js";import{a as Q}from"./chunk-3SOUEDWE.js";import{a as X}from"./chunk-WP5SVQ3H.js";import{a as Y}from"./chunk-OJO3Q2OJ.js";import{a as Z}from"./chunk-256TWJB4.js";import"./chunk-JRVZ5TRL.js";import{a as W}from"./chunk-QYYEOJ6R.js";import{c as j,e as p,f as T,g as q,i as D,j as A,k as P,l as R,m as U,n as B,o as G,p as $,q as L,r as H,s as z,u as J}from"./chunk-N72T7JVJ.js";import{f as N,h as V}from"./chunk-3L2WMKXX.js";import{Cb as f,Cc as E,Dc as k,Eb as y,Gc as M,Mb as l,Nb as g,Ob as C,Qb as F,Vb as O,Wa as a,Xa as u,a as h,b as x,e as c,ja as S,kb as m,ob as s,ra as _,sa as w,tb as n,ub as i,vb as b,zb as I}from"./chunk-UAJ5BYCW.js";function te(o,t){o&1&&(n(0,"span"),l(1,"Delete"),i())}function ie(o,t){o&1&&(n(0,"span",34),b(1,"span",35),l(2,"Deleting..."),i())}function oe(o,t){if(o&1){let e=I();n(0,"button",32),f("click",function(){_(e);let d=y();return w(d.confirmDelete())}),m(1,te,2,0,"span",31)(2,ie,3,0,"span",33),i()}if(o&2){let e=y();s("disabled",e.loading||e.deleting),a(),s("ngIf",!e.deleting),a(),s("ngIf",e.deleting)}}function ne(o,t){if(o&1&&(n(0,"li")(1,"p"),l(2),i()()),o&2){let e=t.$implicit;a(2),F("",e.date," - ",e.user,": ",e.description,"")}}function re(o,t){if(o&1&&(n(0,"div",7)(1,"h3",2),l(2,"Change History"),i(),n(3,"ul"),m(4,ne,3,3,"li",36),i()()),o&2){let e=y();a(4),s("ngForOf",e.changeLogs)}}function le(o,t){if(o&1&&(n(0,"option",37),l(1),i()),o&2){let e=t.$implicit;s("value",e.id),a(),g(e.name)}}function ae(o,t){if(o&1&&(n(0,"option",37),l(1),i()),o&2){let e=t.$implicit;s("value",e.id),a(),g(e.name)}}function se(o,t){if(o&1&&(n(0,"option",37),l(1),i()),o&2){let e=t.$implicit;s("value",e.id),a(),g(e.name)}}function de(o,t){if(o&1&&(n(0,"option",37),l(1),i()),o&2){let e=t.$implicit;s("value",e.id),a(),C("",e.name," ")}}function pe(o,t){o&1&&(n(0,"span"),l(1,"Saving..."),i())}function ue(o,t){if(o&1&&(n(0,"span"),l(1),i()),o&2){let e=y();a(),g(e.isEditMode?"Update":"Create")}}var ee=class o{constructor(t,e,r,d,v,me,ce,fe,ge){this.fb=t;this.opportunityService=e;this.clientService=r;this.solutionService=d;this.authService=v;this.userService=me;this.pipelineStageService=ce;this.router=fe;this.route=ge;this.opportunityForm=this.fb.group({clientId:["",p.required],solutionId:["",p.required],description:["",p.required],value:[0,[p.required,p.min(0)]],probability:[25,[p.required,p.min(0),p.max(100)]],stage:["",p.required],ownerId:["",p.required]})}selectedSolution;getOpportunityValue(){let t=this.opportunityForm.value,e=this.solutions.find(r=>r.id===t.solutionId);e&&this.opportunityForm.patchValue({value:e.cost})}opportunityForm;clients=[];solutions=[];stages=[];owners=[];loading=!1;errorMessage=null;isEditMode=!1;opportunityId=null;changeLogs=[];deleting=!1;ngOnInit(){return c(this,null,function*(){this.opportunityId=this.route.snapshot.paramMap.get("id"),this.isEditMode=!!this.opportunityId,yield this.loadClients(),yield this.loadSolutions(),yield this.loadStages(),yield this.loadOwners();let t=this.authService.getCurrentUser();t&&this.opportunityForm.patchValue({ownerId:t.uid}),this.isEditMode&&this.opportunityId&&(yield this.loadOpportunity(this.opportunityId))})}loadClients(){return c(this,null,function*(){try{this.clients=yield this.clientService.getClients()}catch(t){console.error("Error loading clients:",t)}})}loadSolutions(){return c(this,null,function*(){try{this.solutions=yield this.solutionService.getSolutions()}catch(t){console.error("Error loading solutions:",t)}})}loadStages(){return c(this,null,function*(){try{this.stages=yield this.pipelineStageService.getStagesPromise()}catch(t){console.error("Error loading stages:",t)}})}loadOwners(){return c(this,null,function*(){try{this.owners=yield this.userService.getUsers()}catch(t){console.error("Error loading owners:",t)}})}onStageChange(t){let e=t.target.value,r=this.stages.find(d=>d.id===e);r&&this.opportunityForm.get("probability")?.setValue(r.defaultProbability)}loadOpportunity(t){return c(this,null,function*(){try{let e=yield this.opportunityService.getOpportunityById(t);e&&this.opportunityForm.patchValue({clientId:e.clientId,solutionId:e.solutionId,description:e.description,value:e.value,probability:e.probability,stage:e.stage,ownerId:e.ownerId})}catch(e){console.error("Error loading opportunity:",e),this.errorMessage="Failed to load opportunity details"}})}onSubmit(){return c(this,null,function*(){if(!this.opportunityForm.invalid){this.loading=!0,this.errorMessage=null;try{let t=this.opportunityForm.value,e=this.clients.find(d=>d.id===t.clientId);this.selectedSolution=this.solutions.find(d=>d.id===t.solutionId);let r=x(h({},t),{clientName:e?.name||"",solutionName:this.selectedSolution?.name||""});this.isEditMode&&this.opportunityId?yield this.opportunityService.updateOpportunity(this.opportunityId,r):yield this.opportunityService.createOpportunity(r),this.router.navigate(["/opportunities"])}catch(t){this.errorMessage=t.message||"Failed to save opportunity"}finally{this.loading=!1}}})}goBack(){this.router.navigate(["/opportunities"])}confirmDelete(){return c(this,null,function*(){if(!(!this.isEditMode||!this.opportunityId)&&confirm("Are you sure you want to delete this opportunity? This action cannot be undone.")){this.deleting=!0;try{yield this.opportunityService.deleteOpportunity(this.opportunityId),this.router.navigate(["/opportunities"])}catch(t){console.error("Delete failed",t),alert("Failed to delete opportunity")}finally{this.deleting=!1}}})}static \u0275fac=function(e){return new(e||o)(u(z),u(Q),u(Z),u(Y),u(K),u(X),u(W),u(V),u(N))};static \u0275cmp=S({type:o,selectors:[["app-opportunity-form"]],standalone:!0,features:[O],decls:59,vars:13,consts:[[1,"max-w-4xl","mx-auto","bg-card","text-card-foreground","rounded-lg","shadow-lg"],[1,"p-6","flex","items-start","justify-between"],[1,"text-lg","font-semibold"],[1,"text-sm","text-muted"],["type","button","class","inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium bg-red-600 hover:bg-red-700 text-white h-9 px-3 py-1 disabled:opacity-50",3,"disabled","click",4,"ngIf"],[1,"tabs"],["class","tab",4,"ngIf"],[1,"tab"],[1,"p-6","pt-0",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-2","gap-x-4","gap-y-6"],[1,"col-span-2"],["for","clientId",1,"block","text-sm","font-medium","text-foreground","mb-1"],["id","clientId","formControlName","clientId","required","",1,"flex","h-10","w-full","items-center","justify-between","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","ring-offset-background","placeholder:text-muted-foreground","focus:outline-none","focus:ring-2","focus:ring-ring","focus:ring-offset-2","disabled:cursor-not-allowed","disabled:opacity-50"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","solutionId",1,"block","text-sm","font-medium","text-foreground","mb-1"],["id","solutionId","formControlName","solutionId","required","",1,"flex","h-10","w-full","items-center","justify-between","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","ring-offset-background","placeholder:text-muted-foreground","focus:outline-none","focus:ring-2","focus:ring-ring","focus:ring-offset-2","disabled:cursor-not-allowed","disabled:opacity-50",3,"change"],["for","description",1,"block","text-sm","font-medium","text-foreground","mb-1"],["id","description","formControlName","description","rows","3",1,"flex","min-h-[80px]","w-full","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","ring-offset-background","placeholder:text-muted-foreground","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-ring","focus-visible:ring-offset-2","disabled:cursor-not-allowed","disabled:opacity-50"],[1,"col-span-1"],["for","value",1,"block","text-sm","font-medium","text-foreground","mb-1"],["type","number","id","value","formControlName","value","required","",1,"flex","h-10","w-full","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","ring-offset-background","file:border-0","file:bg-transparent","file:text-sm","file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-ring","focus-visible:ring-offset-2","disabled:cursor-not-allowed","disabled:opacity-50",3,"readOnly"],["for","stage",1,"block","text-sm","font-medium","text-foreground","mb-1"],["id","stage","formControlName","stage","required","",1,"flex","h-10","w-full","items-center","justify-between","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","ring-offset-background","placeholder:text-muted-foreground","focus:outline-none","focus:ring-2","focus:ring-ring","focus:ring-offset-2","disabled:cursor-not-allowed","disabled:opacity-50",3,"change"],["for","probability",1,"block","text-sm","font-medium","text-foreground","mb-1"],["type","number","id","probability","formControlName","probability","min","0","max","100","required","",1,"flex","h-10","w-full","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","ring-offset-background","file:border-0","file:bg-transparent","file:text-sm","file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-ring","focus-visible:ring-offset-2","disabled:cursor-not-allowed","disabled:opacity-50"],["for","ownerId",1,"block","text-sm","font-medium","text-foreground","mb-1"],["id","ownerId","formControlName","ownerId","required","",1,"flex","h-10","w-full","items-center","justify-between","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","ring-offset-background","placeholder:text-muted-foreground","focus:outline-none","focus:ring-2","focus:ring-ring","focus:ring-offset-2","disabled:cursor-not-allowed","disabled:opacity-50"],[1,"flex","justify-end","space-x-2","mt-6"],["type","button",1,"inline-flex","items-center","justify-center","whitespace-nowrap","rounded-md","text-sm","font-medium","ring-offset-background","transition-colors","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-ring","focus-visible:ring-offset-2","disabled:pointer-events-none","disabled:opacity-50","border","border-input","bg-background","hover:bg-accent","hover:text-accent-foreground","h-10","px-4","py-2",3,"click","disabled"],["type","submit",1,"inline-flex","items-center","justify-center","whitespace-nowrap","rounded-md","text-sm","font-medium","ring-offset-background","transition-colors","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-ring","focus-visible:ring-offset-2","disabled:pointer-events-none","disabled:opacity-50","bg-primary","text-primary-foreground","hover:bg-primary/90","h-10","px-4","py-2",3,"disabled"],[4,"ngIf"],["type","button",1,"inline-flex","items-center","justify-center","whitespace-nowrap","rounded-md","text-sm","font-medium","bg-red-600","hover:bg-red-700","text-white","h-9","px-3","py-1","disabled:opacity-50",3,"click","disabled"],["class","flex items-center",4,"ngIf"],[1,"flex","items-center"],[1,"animate-spin","mr-2","h-3","w-3","border-2","border-white","border-t-transparent","rounded-full"],[4,"ngFor","ngForOf"],[3,"value"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),l(4),i(),n(5,"p",3),l(6,"Manage the details for this sales deal."),i()(),m(7,oe,3,3,"button",4),i(),n(8,"div",5),m(9,re,5,1,"div",6),n(10,"div",7)(11,"form",8),f("ngSubmit",function(){return r.onSubmit()}),n(12,"div",9)(13,"div",10)(14,"label",11),l(15,"Client *"),i(),n(16,"select",12)(17,"option",13),l(18,"Select a client"),i(),m(19,le,2,2,"option",14),i()(),n(20,"div",10)(21,"label",15),l(22,"Solution(s) *"),i(),n(23,"select",16),f("change",function(){return r.getOpportunityValue()}),n(24,"option",13),l(25,"Select a solution"),i(),m(26,ae,2,2,"option",14),i()(),n(27,"div",10)(28,"label",17),l(29,"Description"),i(),b(30,"textarea",18),i(),n(31,"div",19)(32,"label",20),l(33,"Value ($) *"),i(),b(34,"input",21),i(),n(35,"div",19)(36,"label",22),l(37,"Stage *"),i(),n(38,"select",23),f("change",function(v){return r.onStageChange(v)}),n(39,"option",13),l(40,"Select a stage"),i(),m(41,se,2,2,"option",14),i()(),n(42,"div",19)(43,"label",24),l(44,"Probability (%) *"),i(),b(45,"input",25),i(),n(46,"div",19)(47,"label",26),l(48,"Owner *"),i(),n(49,"select",27)(50,"option",13),l(51,"Select an owner"),i(),m(52,de,2,2,"option",14),i()()(),n(53,"div",28)(54,"button",29),f("click",function(){return r.goBack()}),l(55," Cancel "),i(),n(56,"button",30),m(57,pe,2,0,"span",31)(58,ue,2,1,"span",31),i()()()()()()),e&2&&(a(4),g(r.isEditMode?"Edit Opportunity":"Create New Opportunity"),a(3),s("ngIf",r.isEditMode),a(2),s("ngIf",r.isEditMode),a(2),s("formGroup",r.opportunityForm),a(8),s("ngForOf",r.clients),a(7),s("ngForOf",r.solutions),a(8),s("readOnly",!0),a(7),s("ngForOf",r.stages),a(11),s("ngForOf",r.owners),a(2),s("disabled",r.loading),a(2),s("disabled",r.opportunityForm.invalid||r.loading),a(),s("ngIf",r.loading),a(),s("ngIf",!r.loading))},dependencies:[M,E,k,J,D,B,G,j,A,U,T,q,H,L,$,P,R],encapsulation:2})};export{ee as OpportunityFormComponent};
