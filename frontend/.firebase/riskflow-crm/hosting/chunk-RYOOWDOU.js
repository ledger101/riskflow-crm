import{a as U}from"./chunk-2YBQOG5B.js";import{b as m,c as d,d as g,e as f,f as w,g as p,h as S,k as n,o as c,r as v,u as b}from"./chunk-6HUQKW6B.js";import{$ as h,e as i,ea as a,l}from"./chunk-UAJ5BYCW.js";var y=class o{constructor(e,t){this.firebaseService=e;this.userService=t;this.auth=this.firebaseService.getAuth(),p(this.auth,r=>{this.currentUserSubject.next(r)})}auth;currentUserSubject=new l(null);currentUser$=this.currentUserSubject.asObservable();actionCodeSettings={url:"https://riskflow-crm.web.app/set-password",handleCodeInApp:!0};signIn(e,t){return i(this,null,function*(){try{yield m(this.auth,e,t)}catch(r){throw console.error("Sign in error:",r),r}})}signOut(){return i(this,null,function*(){try{yield S(this.auth)}catch(e){throw console.error("Sign out error:",e),e}})}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.getCurrentUser()!==null}isAdmin(){return i(this,null,function*(){try{let e=this.getCurrentUser();if(!e)return!1;let t=this.firebaseService.getFirestore(),r=yield c(n(t,"userRoles",e.uid));return r.exists()?r.data().role==="Admin":!1}catch(e){return console.error("Error checking admin status:",e),!1}})}getUserRole(){return i(this,null,function*(){try{let e=this.getCurrentUser();if(!e)return null;let t=this.firebaseService.getFirestore(),r=yield c(n(t,"userRoles",e.uid));return r.exists()&&r.data().role||null}catch(e){return console.error("Error getting user role:",e),null}})}getSalesTeamMembers(){return i(this,null,function*(){return[{id:"1",name:"Alice"},{id:"2",name:"Bob"},{id:"3",name:"Charlie"}]})}sendSignInLink(e){return i(this,null,function*(){yield d(this.auth,e,this.actionCodeSettings),window.localStorage.setItem("pendingEmail",e)})}isEmailLink(e){return g(this.auth,e||window.location.href)}completeEmailLinkSignIn(e,t){return i(this,null,function*(){let r=e||window.location.href,s=t;if(!s&&(s=window.localStorage.getItem("pendingEmail")||"",!s))throw new Error("Email required to complete sign-in");let u=yield f(this.auth,s,r);window.localStorage.removeItem("pendingEmail");try{yield this.userService.markUserConfirmed(u.user.uid,s)}catch{}return u.user})}setInitialPassword(e){return i(this,null,function*(){let t=this.getCurrentUser();if(!t)throw new Error("No authenticated user");yield w(t,e);try{let r=this.firebaseService.getFirestore();yield v(n(r,"userRoles",t.uid),{passwordSet:!0})}catch{}})}static \u0275fac=function(t){return new(t||o)(a(b),a(U))};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};export{y as a};
